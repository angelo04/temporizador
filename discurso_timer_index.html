<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Temporizador de Discurso</title>
  <style>
    :root{
      --bg: #0f172a;
      --card: #0b1220;
      --accent: #06b6d4;
      --muted: #94a3b8;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#071028 0%, #0a1530 100%); color:#e6eef6}
    .app{width:min(880px,96vw); background:var(--card); padding:20px; border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    header{display:flex; align-items:center; justify-content:space-between}
    header h1{margin:0; font-size:20px}
    .grid{display:grid; grid-template-columns:1fr 320px; gap:18px; margin-top:18px}
    .controls{background:var(--glass); padding:16px; border-radius:10px}
    .controls label{display:block; font-size:13px; color:var(--muted); margin-bottom:8px}

    .inputs{display:flex; gap:10px; align-items:end}
    .inputs input[type=number]{width:90px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
    .inputs input[type=text]{flex:1; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}

    .timer-card{display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center; padding:22px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
    .time{font-size:56px; font-weight:700; letter-spacing:1px}
    .progress-wrap{width:100%; height:10px; background:rgba(255,255,255,0.04); border-radius:999px; overflow:hidden}
    .progress{height:100%; width:0%; background:linear-gradient(90deg,var(--accent), #06d6a0); transition:width 0.2s linear}
    .buttons{display:flex; gap:10px; margin-top:6px}
    button{padding:10px 14px; border-radius:8px; border:0; background:rgba(255,255,255,0.03); color:inherit; cursor:pointer}
    button:disabled{opacity:0.5; cursor:not-allowed}
    .footer{margin-top:14px; font-size:13px; color:var(--muted)}

    .overlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(0deg, rgba(0,0,0,0.35), rgba(0,0,0,0.65));}
    .overlay.hidden{display:none}
    .overlay-card{background:var(--card); padding:28px; border-radius:12px; text-align:center; box-shadow:0 10px 40px rgba(2,6,23,0.7)}
    .overlay-card h2{margin:0; font-size:28px}
    .overlay-card button{margin-top:12px}

    @media (max-width:780px){
      .grid{grid-template-columns:1fr;}
      .time{font-size:44px}
    }
  </style>
</head>
<body>
  <div class="app" role="application">
    <header>
      <h1>Temporizador de Discurso</h1>
      <small style="color:var(--muted)">Práctica y entreno rápido</small>
    </header>

    <div class="grid">
      <div class="timer-card">
        <div class="time" id="time" aria-live="polite">05:00</div>
        <div class="progress-wrap" aria-hidden="true"><div id="progress" class="progress"></div></div>
        <div class="buttons">
          <button id="startBtn">Iniciar</button>
          <button id="pauseBtn" disabled>Pausar</button>
          <button id="resetBtn" disabled>Reset</button>
        </div>
        <div class="footer">Atajos: <strong>barra espaciadora</strong> iniciar/pausar · <strong>R</strong> reset</div>
      </div>

      <div class="controls">
        <label>Duración</label>
        <div class="inputs">
          <div>
            <label style="font-size:12px;color:var(--muted)">Minutos</label>
            <input id="inputMin" type="number" min="0" value="5" />
          </div>
          <div>
            <label style="font-size:12px;color:var(--muted)">Segundos</label>
            <input id="inputSec" type="number" min="0" max="59" value="0" />
          </div>
        </div>

        <div style="height:12px"></div>
        <label style="margin-top:6px">Frase final</label>
        <input id="inputPhrase" type="text" value="Finalizó el discurso" placeholder="Texto que aparecerá al finalizar" />

        <div style="height:12px"></div>
        <label style="display:flex; gap:8px; align-items:center; font-size:14px"><input id="ttsChk" type="checkbox" checked /> Usar voz (TTS)</label>

        <div style="height:12px"></div>
        <small style="color:var(--muted)">Los ajustes se guardan en tu navegador.</small>
      </div>
    </div>

  </div>

  <div id="overlay" class="overlay hidden" role="dialog" aria-modal="true">
    <div class="overlay-card">
      <h2 id="overlayText">Finalizó el discurso</h2>
      <button id="closeOverlay">Cerrar</button>
    </div>
  </div>

  <script>
  (function(){
    const minInput = document.getElementById('inputMin');
    const secInput = document.getElementById('inputSec');
    const phraseInput = document.getElementById('inputPhrase');
    const ttsChk = document.getElementById('ttsChk');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const timeEl = document.getElementById('time');
    const progressEl = document.getElementById('progress');
    const overlay = document.getElementById('overlay');
    const overlayText = document.getElementById('overlayText');
    const closeOverlay = document.getElementById('closeOverlay');

    let originalDuration = 5*60*1000;
    let remaining = originalDuration;
    let endTime = 0;
    let timerInterval = null;
    let running = false;

    function pad(n){ return String(n).padStart(2,'0'); }

    function msFromInputs(){
      const m = Math.max(0, Number(minInput.value) || 0);
      let s = Math.max(0, Number(secInput.value) || 0);
      if (s > 59) s = 59;
      return (m*60 + s) * 1000;
    }

    function saveSettings(){
      localStorage.setItem('discurso_timer_settings', JSON.stringify({
        min: minInput.value,
        sec: secInput.value,
        phrase: phraseInput.value,
        tts: ttsChk.checked
      }));
    }

    function loadSettings(){
      const json = localStorage.getItem('discurso_timer_settings');
      if (json){
        try{
          const s = JSON.parse(json);
          if (s.min !== undefined) minInput.value = s.min;
          if (s.sec !== undefined) secInput.value = s.sec;
          if (s.phrase !== undefined) phraseInput.value = s.phrase;
          if (s.tts !== undefined) ttsChk.checked = s.tts;
        }catch(e){ /* ignore */ }
      }
    }

    function updateDisplay(ms){
      const totalSec = Math.max(0, Math.ceil(ms/1000));
      const minutes = Math.floor(totalSec/60);
      const seconds = totalSec % 60;
      timeEl.textContent = `${pad(minutes)}:${pad(seconds)}`;
      if (originalDuration > 0){
        const elapsed = originalDuration - Math.max(0, ms);
        const pct = Math.min(100, Math.max(0, (elapsed / originalDuration) * 100));
        progressEl.style.width = pct + '%';
      } else {
        progressEl.style.width = '0%';
      }
    }

    function tick(){
      remaining = endTime - Date.now();
      if (remaining <= 0){ finish(); }
      else updateDisplay(remaining);
    }

    function startTimer(){
      if (running) return;
      if (!remaining || remaining <= 0){
        remaining = msFromInputs();
        originalDuration = remaining;
      }
      endTime = Date.now() + remaining;
      timerInterval = setInterval(tick, 200);
      running = true;
      updateButtons();
      disableInputs(true);
    }

    function pauseTimer(){
      if (!running) return;
      clearInterval(timerInterval);
      remaining = Math.max(0, endTime - Date.now());
      running = false;
      updateButtons();
      disableInputs(false);
      updateDisplay(remaining);
    }

    function resetTimer(){
      clearInterval(timerInterval);
      remaining = msFromInputs();
      originalDuration = remaining;
      running = false;
      updateButtons();
      disableInputs(false);
      updateDisplay(remaining);
    }

    function finish(){
      clearInterval(timerInterval);
      remaining = 0;
      running = false;
      updateButtons();
      disableInputs(false);
      updateDisplay(0);

      const phrase = (phraseInput.value || '').trim() || 'Finalizó el discurso';
      showOverlay(phrase);

      if (ttsChk.checked && 'speechSynthesis' in window){
        const utter = new SpeechSynthesisUtterance(phrase);
        utter.lang = 'es-ES';
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utter);
      }

      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine';
        o.frequency.value = 880;
        g.gain.value = 0.05;
        o.connect(g);
        g.connect(ctx.destination);
        o.start();
        setTimeout(()=>{ o.stop(); ctx.close(); }, 400);
      }catch(e){ /* audio might be blocked */ }

      if (navigator.vibrate) navigator.vibrate([200,100,200]);
    }

    function updateButtons(){
      startBtn.disabled = running;
      pauseBtn.disabled = !running;
      // disable reset if not running and already at input values
      resetBtn.disabled = (!running && remaining === msFromInputs());
    }

    function disableInputs(disabled){
      minInput.disabled = disabled;
      secInput.disabled = disabled;
      phraseInput.disabled = disabled;
      ttsChk.disabled = disabled;
    }

    function showOverlay(text){
      overlayText.textContent = text;
      overlay.classList.remove('hidden');
    }
    function closeOverlayFn(){ overlay.classList.add('hidden'); }

    startBtn.addEventListener('click', ()=>{
      if (!running){
        remaining = msFromInputs();
        originalDuration = remaining;
        saveSettings();
        startTimer();
      }
    });
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', ()=>{ resetTimer(); saveSettings(); });
    closeOverlay.addEventListener('click', ()=>{ closeOverlayFn(); });

    document.addEventListener('keydown', (e)=>{
      if (e.code === 'Space'){
        e.preventDefault();
        if (running) pauseTimer(); else startTimer();
      } else if (e.key.toLowerCase() === 'r'){
        resetTimer();
      }
    });

    minInput.addEventListener('input', ()=>{ saveSettings(); updateButtons(); });
    secInput.addEventListener('input', ()=>{ saveSettings(); updateButtons(); });
    phraseInput.addEventListener('input', ()=> saveSettings());
    ttsChk.addEventListener('change', ()=> saveSettings());

    loadSettings();
    remaining = msFromInputs();
    originalDuration = remaining;
    updateDisplay(remaining);
    updateButtons();

  })();
  </script>
</body>
</html>
